# EDK Ⅱ の導入
今回は、EDK Ⅱ という Intel が公開している UEFI 向けの開発ツールを導入し、前回作成した "Hello World!" を表示するプログラムを作り直してみます。
EDK Ⅱ は [GitHub の tianocore/edk2](https://github.com/tianocore/edk2) で公開されています。

## Dockerfile の修正
[GitHub の uchan-nos/mikanos-build にある build-edk2.sh](https://github.com/uchan-nos/mikanos-build/blob/master/devenv/build-edk2.sh) をもとに、```Dockerfile``` に以下を追記します。

```dockerfile
# EDK II のインストール
WORKDIR /home/ubuntu

RUN git clone https://github.com/tianocore/edk2.git && \
    cd edk2 && \
    git submodule update --init --recursive && \
    make -C BaseTools/Source/C
```

EDK Ⅱ を置いておくディレクトリはどこでも良いのですが、ここでは元から用意されている ```/home/ubuntu``` ディレクトリの中に配置することにしました。
上記を書き加えて ```docker compose build``` すれば、EDK Ⅱ を含むイメージが出来上がります。

## EDK Ⅱ　を使った Hello World
EDK Ⅱ で Hello World を表示する準備として、以下のようなファイル達を作成します。

```
./mikanos_cpp/MikanLoaderPkg
├── Loader.inf
├── Main.c
├── MikanLoaderPkg.dec
└── MikanLoaderPkg.dsc
```

### ```MikanLoaderPkg.dec``` ファイル
DEC ファイルは、パッケージ名などを指定するファイルです。

```dec
[Defines]
  DEC_SPECIFICATION              = 0x00010005
  PACKAGE_NAME                   = MikanLoaderPkg
  PACKAGE_GUID                   = 452eae8e-71e9-11e8-a243-df3f1ffdebe1
  PACKAGE_VERSION                = 0.1
```

それぞれの項目の設定内容は以下の通りです。

- ```DEC_SPECIFICATION```: DEC ファイルの仕様バージョン
- ```PACKAGE_NAME```: パッケージ名
- ```PACKAGE_GUID```: パッケージの GUID
- ```PACKAGE_VERSION```: パッケージのバージョン

パッケージの頒布や EDK Ⅱ へのマージの予定がない限り、```PACKAGE_NAME``` が間違いなく指定できていれば、他は書籍の値をそのまま使っても問題ありません。

### ```MikanLoaderPkg.dsc``` ファイル
まず、```Define``` セクションの設定項目は以下の通りです。

- ```PLATFORM_NAME```: 
- ```PLATFORM_GUID```: 
- ```PLATFORM_VERSION```: 
- ```DSC_SPECIFICATION```: 
- ```OUTPUT_DIRECTORY```: 
- ```SUPPORTED_ARCHITECTURES```: 
- ```BUILD_TARGETS```: 

### ```Loader.inf``` ファイル

## ソースコードのビルドと起動
最後に EDK Ⅱ でソースコードをビルドして、QEMU で起動してみます。
まず、EDK Ⅱ を配置したディレクトリ (ここでは ```/home/ubuntu/edk2```) に移動して、ソースコードの置いてあるディレクトリ (ここでは ```/app/MikanLoaderPkg```) のシンボリックリンクを作成します。

```bash
$ cd /home/ubuntu/edk2
$ ln -s /app/MikanLoaderPkg ./
```

次に、```edksetup.sh``` を読み込んで、```Conf/target.sh``` ファイルを生成します。

```bash
$ source edksetup.sh
```

生成された ```Conf/target.txt``` を以下のように書き換えます。

